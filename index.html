<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="This package reads whole genome multilocus sequence
    typing profiles with food sources to create a random
    forest model. Then, another wgMLST profile can query the
    model to yield a prediction of which food source it might have
    come from.">
<title>Predicts Food Source from an MLST Profile • sourcerer</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Predicts Food Source from an MLST Profile">
<meta property="og:description" content="This package reads whole genome multilocus sequence
    typing profiles with food sources to create a random
    forest model. Then, another wgMLST profile can query the
    model to yield a prediction of which food source it might have
    come from.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">sourcerer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ncezid-biome/source-attribution-MLST/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="source-attribution-mlst">source-attribution-MLST<a class="anchor" aria-label="anchor" href="#source-attribution-mlst"></a>
</h1></div>
<p>This repo describes the source attributions project from the Enterics Diseases Epidemiology Branch (EDEB) and the Enteric Diseases Laboratory Branch (EDLB) in the Division of Foodborne, Waterborne, and Environmental Diseases at CDC.</p>
<p>The manuscript can be found at <a href="https://doi.org/10.1089/fpd.2023.0046" class="external-link uri">https://doi.org/10.1089/fpd.2023.0046</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Requires R and <code>devtools</code></p>
<pre class="shell"><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ncezid-biome/source-attribution-MLST"</span><span class="op">)</span></span></code></pre>
<p>To install the executable scripts, locate where they were installed, e.g., <code>$HOME/R/4/3.2/sourcerer</code>, and update your <code>PATH</code>. In Linux, it looks like this:</p>
<pre class="shell"><code># Find the installation
find ~ -type d -name sourcerer
# =&gt; assume the path is $HOME/R/4/3.2/sourcerer for this example
export PATH=$PATH:$HOME/R/4/3.2/sourcerer/exec
# Double check the installation with the which command
which bootstrapRF.R
which predictRF.R
</code></pre>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>You can use this package either with the executable Rscripts or via the API.</p>
<p>Either way, first, create a model or models with <code><a href="reference/bootstrapping.html">bootstrapping()</a></code> or <code>Rscript bootstrapRF.R</code>. Then, query the model with <code><a href="reference/prediction.html">prediction()</a></code> or <code>Rscript predictRF.R</code>.</p>
<p>Creating a model is done with a “bootstrap” because it represents only one outcome out of all the stochatic outcomes in the random forest model. Therefore, the usage is to create many models and then run prediction on many models to get an aggregated outcome.</p>
<div class="section level3">
<h3 id="examples-with-api">Examples with API<a class="anchor" aria-label="anchor" href="#examples-with-api"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ncezid-biome.github.io/source-attribution-MLST">"sourcerer"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Command line argument parsing</span></span>
<span><span class="va">option_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-i"</span>, <span class="st">"--input"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"character"</span>, help <span class="op">=</span> <span class="st">"Spreadsheet describing MLST profiles, in csv or csv.gz format."</span><span class="op">)</span>,</span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-o"</span>, <span class="st">"--output"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"character"</span>, help <span class="op">=</span> <span class="st">"Directory of bootstrap random forest models to output"</span>, default <span class="op">=</span> <span class="st">"results"</span><span class="op">)</span>,</span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-d"</span>, <span class="st">"--dependent"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"character"</span>, help <span class="op">=</span> <span class="st">"The dependent variable in the spreadsheet. Default:food"</span>, default <span class="op">=</span> <span class="st">"food"</span><span class="op">)</span>,</span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-c"</span>, <span class="st">"--core-loci"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"character"</span>, help <span class="op">=</span> <span class="st">"A comma-separated list of core loci to help remove duplicate isolates. These loci must be present as headers in the spreadsheet from --input."</span><span class="op">)</span>,</span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"--starts-with"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"character"</span>, help <span class="op">=</span> <span class="st">"The prefix of all independent variables. Default:LMO"</span>, default <span class="op">=</span> <span class="st">"LMO"</span><span class="op">)</span>,</span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"--seed"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"integer"</span>, help <span class="op">=</span> <span class="st">"Random seed. Default:23"</span>, default <span class="op">=</span> <span class="fl">23</span><span class="op">)</span>,</span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-b"</span>, <span class="st">"--bootstraps"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"integer"</span>, help <span class="op">=</span> <span class="st">"How many random forest bootstraps to output"</span>, default <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-t"</span>, <span class="st">"--threads"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"integer"</span>, help <span class="op">=</span> <span class="st">"How many cores to use. Default:1"</span>, default <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">opt_parser</span> <span class="op">&lt;-</span> <span class="fu">OptionParser</span><span class="op">(</span>option_list <span class="op">=</span> <span class="va">option_list</span><span class="op">)</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu">parse_args</span><span class="op">(</span><span class="va">opt_parser</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># required options</span></span>
<span><span class="va">required_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"input"</span>, <span class="st">"output"</span>, <span class="st">"core-loci"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">o</span> <span class="kw">in</span> <span class="va">required_options</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">o</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">opt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"ERROR: Required option"</span>, <span class="va">o</span>, <span class="st">"is missing.\n"</span><span class="op">)</span></span>
<span>    <span class="fu">print_help</span><span class="op">(</span><span class="va">opt_parser</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/quit.html" class="external-link">q</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># On second thought, get 10 bootstraps instead of the default of 1</span></span>
<span><span class="va">opt</span><span class="op">$</span><span class="va">bootstraps</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Slow RF modeling step</span></span>
<span><span class="va">rf_filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bootstrapping.html">bootstrapping</a></span><span class="op">(</span><span class="va">opt</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Start on the prediction step</span></span>
<span><span class="va">option_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-m"</span>, <span class="st">"--model"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"character"</span>, help <span class="op">=</span> <span class="st">"A single random forest model RDS file"</span><span class="op">)</span>,</span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-q"</span>, <span class="st">"--query"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"character"</span>, help <span class="op">=</span> <span class="st">"A CSV file with two rows: a header and values for an MLST profile. The header should only have columns with relevant loci and not even an identifier for the genome."</span><span class="op">)</span>,</span>
<span>    <span class="fu">make_option</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-t"</span>, <span class="st">"--threads"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"integer"</span>, help <span class="op">=</span> <span class="st">"How many cores to use. Default: 1"</span>, default <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">opt_parser</span> <span class="op">&lt;-</span> <span class="fu">OptionParser</span><span class="op">(</span>option_list <span class="op">=</span> <span class="va">option_list</span><span class="op">)</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu">parse_args</span><span class="op">(</span><span class="va">opt_parser</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change the model filenames to the ones you already have</span></span>
<span><span class="va">opt</span><span class="op">$</span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">rf_filenames</span></span>
<span></span>
<span><span class="co"># required options</span></span>
<span><span class="va">required_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"query"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">o</span> <span class="kw">in</span> <span class="va">required_options</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">o</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">opt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"ERROR: Required option"</span>, <span class="va">o</span>, <span class="st">"is missing.\n"</span><span class="op">)</span></span>
<span>    <span class="fu">print_help</span><span class="op">(</span><span class="va">opt_parser</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/quit.html" class="external-link">q</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/prediction.html">prediction</a></span><span class="op">(</span><span class="va">opt</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the first prediction table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">predicted</span>,</span>
<span>            file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdout</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            sep  <span class="op">=</span> <span class="st">"\t"</span>,</span>
<span>            quote <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            col.names <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="examples-with-executable-scripts">Examples with executable scripts<a class="anchor" aria-label="anchor" href="#examples-with-executable-scripts"></a>
</h3>
<div class="section level4">
<h4 id="basic-example">Basic example<a class="anchor" aria-label="anchor" href="#basic-example"></a>
</h4>
<p>In this example, we make one random forest model under <code>results/bs23.rds</code>, and then we query with the provided example MLST profile <code>data/example_query.csv</code>. If more bootstraps were requested than 1, there would be more files under <code>results/</code>. Each random forest number is given a bootstrap number in the file name, with the random seed used. Seeds are incremented by 1 if more bootstraps are requested.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Rscript scripts<span class="sc">/</span>bootstrapRF.R <span class="sc">--</span>input data<span class="sc">/</span>isolates_original_plus_new_dec_1_2021.csv.gz <span class="sc">-</span>o results <span class="sc">--</span>dependent food <span class="sc">--</span>core<span class="sc">-</span>loci data<span class="sc">/</span>cgMLST_loci.csv <span class="sc">--</span>starts<span class="sc">-</span>with LMO <span class="sc">--</span>bootstraps <span class="dv">1</span> <span class="sc">--</span>threads <span class="dv">8</span> <span class="sc">--</span>seed <span class="dv">23</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Rscript scripts<span class="sc">/</span>predictRF.R <span class="sc">--</span>query data<span class="sc">/</span>example_query.csv <span class="sc">-</span>m results<span class="sc">/</span>bs23.rds <span class="sc">--</span>threads <span class="dv">1</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parallelized-model-creation">Parallelized model creation<a class="anchor" aria-label="anchor" href="#parallelized-model-creation"></a>
</h4>
<p>You can use <code>--threads</code> to use multiple cores in the underlying libraries. However, you can let the operating system parallelize the calls if you have many models to create.</p>
<p>Using this exact method, we call 4 random seeds with <code>shuf</code> and parallelize with <code>xargs</code> using 4 processors. The seed is transferred to the program with <code>--seed</code>. We request 10 models using <code>--bootstraps</code> and therefore we are getting 4 x 10 = 40 models. Formally, it is possible that the seeds are close enough to each other that some output models will override each other. You can try to avoid that by increasing the range in <code>shuf</code> or by creating one-off models to fill in the gaps.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>shuf <span class="sc">-</span>i <span class="dv">1-9999</span> <span class="sc">-</span>n <span class="dv">4</span> <span class="sc">|</span> \</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  xargs <span class="sc">-</span>n <span class="dv">1</span> <span class="sc">-</span>P <span class="dv">4</span> bash <span class="sc">-</span>c <span class="st">'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">    Rscript scripts/bootstrapRF.R --input data/isolates_original_plus_new_dec_1_2021.csv.gz -o results/LMO0003 --dependent food --core-loci data/cgMLST_loci.csv --starts-with LMO0003 --bootstraps 10 --threads 1 --seed $0</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">  '</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parallelized-predicting">Parallelized predicting<a class="anchor" aria-label="anchor" href="#parallelized-predicting"></a>
</h4>
<p>This method reads all the rds model files you have created and sends them to <code>xargs</code>. Each model will give a prediction in tab-delimited format. At the end as an optional step, we suggest using <code>column -t</code> which aligns columns in a terminal.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>\ls results<span class="sc">/</span>LMO0003<span class="sc">/</span><span class="er">*</span>.rds <span class="sc">|</span> \</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  xargs <span class="sc">-</span>n <span class="dv">1</span> <span class="sc">-</span>P <span class="dv">8</span> bash <span class="sc">-</span>c <span class="st">'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">    Rscript scripts/predictRF.R --query data/example_query.csv -m $0 --threads 1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">  '</span> <span class="sc">|</span> \</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  column <span class="sc">-</span>t</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="complete-usage">Complete usage<a class="anchor" aria-label="anchor" href="#complete-usage"></a>
</h3>
<pre class="text"><code>Usage: scripts/bootstrapRF.R [options]


Options:
        -i INPUT, --input=INPUT
                Spreadsheet describing MLST profiles, in csv or csv.gz format.

        -o OUTPUT, --output=OUTPUT
                Directory of bootstrap random forest models to output

        -d DEPENDENT, --dependent=DEPENDENT
                The dependent variable in the spreadsheet. Default:food

        -c CORE-LOCI, --core-loci=CORE-LOCI
                A comma-separated list of core loci to help remove duplicate isolates. These loci must be present as headers in the spreadsheet from --input.

        --starts-with=STARTS-WITH
                The prefix of all independent variables. Default:LMO

        --seed=SEED
                Random seed. Default:23

        -b BOOTSTRAPS, --bootstraps=BOOTSTRAPS
                How many random forest bootstraps to output

        -t THREADS, --threads=THREADS
                How many cores to use. Default:1

        -h, --help
                Show this help message and exit</code></pre>
<pre class="text"><code>Usage: scripts/predictRF.R [options]


Options:
        -m MODEL, --model=MODEL
                A single random forest model RDS file

        -q QUERY, --query=QUERY
                A CSV file with two rows: a header and values for an MLST profile. The header should only have columns with relevant loci and not even an identifier for the genome.

        -t THREADS, --threads=THREADS
                How many cores to use. Default: 1

        -h, --help
                Show this help message and exit</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="aggregating-the-data">Aggregating the data<a class="anchor" aria-label="anchor" href="#aggregating-the-data"></a>
</h2>
<p>For a given query, each random forest model can yield a different outcome. Therefore, you need to aggregate results across these bootstraps.</p>
<p>Here is one method as an example that finds the mean for each category on the command line.</p>
<pre class="shell"><code>\ls tests/testthat/test-results/*.rds | xargs -n 1 -P 1 Rscript exec/predictRF.R --query data/example_query.csv --threads 4 --model | grep -v dairy | datamash mean 1 mean 2 mean 3 mean 4 mean 5 | column -t
ℹ Loading sourcerer
ℹ Loading sourcerer
ℹ Loading sourcerer
INFO [2024-01-24 14:19:38] Running with 4 cores.
INFO [2024-01-24 14:19:38] Will read model: tests/testthat/test-results/bs23.rds
INFO [2024-01-24 14:19:38] Running with 4 cores.
INFO [2024-01-24 14:19:38] Will read model: tests/testthat/test-results/bs24.rds
INFO [2024-01-24 14:19:38] Running with 4 cores.
INFO [2024-01-24 14:19:38] Will read model: tests/testthat/test-results/bs25.rds
0.15012679321561  0.15789806734794  0.31114043339838  0.16977994687198  0.21105475916609</code></pre>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ncezid-biome/source-attribution-MLST/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ncezid-biome/source-attribution-MLST/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing sourcerer</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Lee Katz <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-2533-9161" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Zhaohui Cui <br><small class="roles"> Author </small>  </li>
<li>Sean Browning <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-4580-1843" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lee Katz, Zhaohui Cui, Sean Browning.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
